name: Deploy to VPS

on:
  push:
    branches: [ "main", "master" ]

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Execute remote ssh commands
      uses: appleboy/ssh-action@v1.0.3
      with:
        host: ${{ secrets.HOST }}
        username: ${{ secrets.USERNAME }}
        key: ${{ secrets.SSH_PRIVATE_KEY }}
        port: 22
        script: |
          set -e # –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–∫—Ä–∏–ø—Ç –ø—Ä–∏ –æ—à–∏–±–∫–µ

          cd ~/TrainingSpace
          

          echo "Pulling latest code..."
          git pull origin main 

          echo "üöÄ Deploying Backend..."
          cd backend
          yarn install
          yarn build
          pm2 restart backend
          cd ..

          echo "üé® Deploying Frontend..."
          cd frontend
          yarn install
          yarn build
          pm2 restart frontend
          
          echo "‚úÖ Deployment finished!"